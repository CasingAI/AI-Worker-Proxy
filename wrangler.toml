name = "ai-worker-proxy"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Cloudflare dashboard logs (optional)
[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = false

# ====================================================================================
# EXAMPLE CONFIGURATION
# ====================================================================================
# This [vars] section contains example configuration.
# GitHub Actions will REPLACE it with real ROUTES_CONFIG from GitHub Variable.
# Secrets (PROXY_AUTH_TOKEN, API keys) are set in Cloudflare Dashboard manually.
# ====================================================================================

[vars]
# Model routing configuration (example - will be replaced by GitHub Actions)
ROUTES_CONFIG = '''
{
  "zhipu-flash-latest": {
    "displayName": "GLM 4.7 Flash X",
    "providers": [
      {
        "provider": "zhipu",
        "model": "glm-4.7-flash",
        "apiKeys": ["ZHIPU_KEY_1"],
        "contextWindow": 200000,
        "maxOutputTokens": 16384,
        "description": "智谱提供的 30B 级 SOTA 模型，兼顾性能与效率的新选择。",
        "pricingCurrency": "cny",
        "inputPricePer1m": 0.5,
        "inputCachePricePer1m": 0.1,
        "outputPricePer1m": 3
      }
    ],
    "metadata": {
      "tier": "free"
    }
  },
  "glm-4.6v-flash": {
    "displayName": "GLM 4.6V Flash",
    "providers": [
      {
        "provider": "zhipu",
        "model": "glm-4.6v-flash",
        "apiKeys": ["ZHIPU_KEY_1"],
        "contextWindow": 128000,
        "maxOutputTokens": 0,
        "description": "智谱提供的 12B 多模态模型，视觉理解精度上达到同参数规模 SOTA",
        "pricingCurrency": "cny",
        "inputPricePer1m": 0.3,
        "inputCachePricePer1m": 0.03,
        "outputPricePer1m": 3
      }
    ],
    "metadata": {
      "tier": "free"
    },
    "flags": ["image"]
  }
}
'''
PROXY_AUTH_TOKEN = "testGiuyghi"

# Secrets to set in Cloudflare Dashboard:
# - PROXY_AUTH_TOKEN
# - OPENAI_KEY_1, OPENAI_KEY_2
# - ZHIPU_KEY_1
